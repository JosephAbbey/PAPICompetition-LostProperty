<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ title }}</title>
        <link rel="stylesheet" href="/static/style.css" />
        <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    </head>
    <body>
        <script type="module" src="/static/index.mjs"></script>
        <nav-top></nav-top>
        <div style="height: 3.8rem"></div>

        <div id="camera">
            <button id="camera">Take photo</button>
            <video id="video" width="320" height="240" autoplay></video>
            <canvas id="canvas" width="320" height="240" hidden></canvas>
            <script>
                let camera_button = document.querySelector("#camera");
                let video = document.querySelector("#video");
                
                navigator.mediaDevices.getUserMedia({video: true})
                    .then(stream => {
                        video.srcObject = stream; 
                        return video.play();
                    })
                    .then(() => {
                        camera_button.disabled = false;
                        camera_button.onclick = e => {
                            takeASnap().then(a => {
                                var file = new File([a], "img.jpg", { type:"image/jpeg", lastModified: new Date().getTime() });
                                
                                var container = new DataTransfer();
                                container.items.add(file);
                                document.querySelector("#image").files = container.files;
                            });
                        };
                    });

                function takeASnap(){
                    const canvas = document.querySelector('#canvas'); 
                    const ctx = canvas.getContext('2d'); 
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0,0);
                    return new Promise((res, rej)=>{
                        canvas.toBlob(res, 'image/jpeg');
                    });
                }
            </script>
        </div>

        <form action="/add" method="post">
            <select name="title" id="title">
                {% for title in titles %}
                    <option value="{{ title }}">{{ title }}</option>
                {% endfor %}
            </select>
            <select name="category" id="category">
                {% for category in categories %}
                    <option value="{{ category }}">{{ category }}</option>
                {% endfor %}
            </select>
            <select name="colour" id="colour">
                {% for colour in colours %}
                    <option value="{{ colour }}">{{ colour }}</option>
                {% endfor %}
            </select>
            <button type="button" onclick="takeImage()">Add image</button>
            <input name="image" id="image" type="file">
            <select name="location" id="location">
                {% for location in locations %}
                    <option value="{{ location }}">{{ location }}</option>
                {% endfor %}
            </select>
            <input type="number" name="store" placeholder="store" required>

            <button>Add item</button>
        </form>
    </body>
</html>
